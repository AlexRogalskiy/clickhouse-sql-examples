-- Store readings data in S3.
SELECT {AWS_S3_BUCKET:String}||'/readings_{_partition_id}.dat.gz';

SELECT {AWS_ACCESS_KEY_ID:String};

SELECT {AWS_SECRET_ACCESS_KEY:String};

INSERT INTO FUNCTION s3({AWS_S3_BUCKET:string}||'/readings_{_partition_id}.dat.gz',
 {AWS_ACCESS_KEY_ID:string}, {AWS_SECRET_ACCESS_KEY:string}, Native, 
 'sensor_id Int32, sensor_type String, location String, time DateTime, reading Float32', 'gzip') PARTITION BY rand() % 20
SELECT
    sensor_id,
    sensor_type,
    location,
    time,
    reading
from readings
